#+TITLE: Emacs Configuration
#+PROPERTY: header-args :tangle yes
* Package Initialization and Installation
** Garbage Collection
#+BEGIN_SRC emacs-lisp
;; Allocate more memory to the garbage collector during initialization.
(setq gc-cons-threshold (* 500 1024 1024))
;; Reset it to the default after initialization
(add-hook 'after-init-hook (lambda () (setq gc-cons-threshold (* 5 1024 1024))))
#+END_SRC
** Automatic tangling
Taken from [[https://github.com/larstvei/dot-emacs/][larstvei]]
#+BEGIN_SRC emacs-lisp
(defun tangle-init ()
  (interactive)
  ;; Continue only if init.org is the current file
  (when (equal (buffer-file-name)
               (expand-file-name (concat user-emacs-directory "init.org")))
    (let ((prog-mode-hook nil))
      (org-babel-tangle)
      (load-file (expand-file-name (concat user-emacs-directory "init.el"))))))

(add-hook 'after-save-hook 'tangle-init)
#+END_SRC
** MELPA
#+BEGIN_SRC emacs-lisp
(unless (eq system-type 'windows-nt)
  (setq tlc-checktrust t))

(when (>= emacs-major-version 24)
  (require 'package)
  (add-to-list
   'package-archives
   '("melpa" . "http://melpa.org/packages/")
   t)
  (package-initialize))

(unless package-archive-contents
  (package-refresh-contents))

#+END_SRC
** Install use-package
Make sure that use-package is installed and that ensure is always on so that use-package downloads every package that is not installed.
#+BEGIN_SRC emacs-lisp
(unless (package-installed-p 'use-package)
  (package-refresh-contents)
  (package-install 'use-package))
(setq use-package-always-ensure t)
#+END_SRC
* Misc options
** Startup with tramp
#+BEGIN_SRC emacs-lisp
;;(require 'tramp)
(setq tramp-default-method "ssh"
      tramp-backup-directory-alist backup-directory-alist
      tramp-ssh-controlmaster-options "ssh")
#+END_SRC
** Custom Keybinds
#+BEGIN_SRC emacs-lisp
;;Replace the default switch buffer key with the smarter ibuffer window
(global-set-key (kbd "C-x C-b") 'ibuffer)

(global-set-key (kbd "C-c w") 'whitespace-mode)

(global-set-key (kbd "C-c c") 'quick-calc)

(global-set-key (kbd "C-c a") 'org-agenda-list)
(global-set-key (kbd "C-c o") 'org-capture)

(global-set-key (kbd "C-c g") 'gnus)

(global-set-key (kbd "<f8>") 'compile)
#+END_SRC
** Random Quality of Life Things
#+BEGIN_SRC emacs-lisp
;; Delete all the trailing whitespaces every time the file is saved
(push 'delete-trailing-whitespace before-save-hook)
;;Show current buffer name
(setq frame-title-format "emacs - %b")
;;Hide the toolbar scroll bar and menubar
(tool-bar-mode -1)
(menu-bar-mode -1)
(toggle-scroll-bar -1)

;; Always treat tabs as spaces
(setq-default indent-tabs-mode nil)

;;Truncate lines instead of word wrapping them
(setq-default truncate-lines t)
;; Use y or n instead of yes or no
(defalias 'yes-or-no-p 'y-or-n-p)

;; Disable the visual bell and the audio bell
(setq visible-bell nil)
(setq ring-bell-function 'ignore)

;; 99% opacity when the window is active, 90% when it is in the background.
;;(set-frame-parameter (selected-frame) 'alpha '(99 . 90))
;;(add-to-list 'default-frame-alist '(alpha . (99 . 90)))
(when (fboundp 'windmove-default-keybindings)
  (windmove-default-keybindings))
#+END_SRC
*** Easily search for non ASCII Characters
#+BEGIN_SRC emacs-lisp
(setq search-default-mode #'char-fold-to-regexp)
(setq replace-char-fold t)
#+END_SRC
*** Prettify symbols mode
#+BEGIN_SRC emacs-lisp
(global-prettify-symbols-mode)
(setq prettify-symbols-unprettify-at-point 'right-edge)
#+END_SRC
** Open eshell in current window
Credit goes to [[https://www.reddit.com/r/emacs/comments/1zkj2d/advanced_usage_of_eshell/cfugwkt][/u/howardabrams]] and [[https://www.reddit.com/r/emacs/comments/1zkj2d/advanced_usage_of_eshell/cfuuo5y][/u/AndersBakken]]
#+BEGIN_SRC emacs-lisp
(defun eshell-here ()
  "Opens up a new shell in the directory associated with the current buffer's file."
  (interactive)
  (let* ((parent (if (buffer-file-name)
                     (file-name-directory (buffer-file-name))
                   default-directory))
         (name (car (last (split-string parent "/" t)))))
    (split-window-vertically)
    (other-window 1)
    (eshell)
    (rename-buffer (concat "Eshell: " name))
    (insert (concat "ls"))
    (eshell-send-input)))

(global-set-key (kbd "C-c s") 'eshell-here)
#+END_SRC
** UTF-8 and Fonts
#+BEGIN_SRC emacs-lisp
(if (eq system-type 'windows-nt)
    (set-face-attribute 'default nil :family "Consolas" :height 100)
  (set-face-attribute 'default nil :family "DejaVu Sans Mono"))

;;The following lines force UTF-8 whenever possible
(prefer-coding-system 'utf-8)
(set-default-coding-systems 'utf-8)
(set-terminal-coding-system 'utf-8)
(set-keyboard-coding-system 'utf-8)
(set-language-environment 'utf-8)
#+END_SRC
*** Dos2Unix
#+BEGIN_SRC emacs-lisp
(defun dos2unix ()
  "Not exactly but it's easier to remember"
  (interactive)
  (set-buffer-file-coding-system 'unix 't) )

(defun unix2dos ()
  "Not exactly but it's easier to remember"
  (interactive)
  (set-buffer-file-coding-system 'dos 't))
#+END_SRC
** Clipboard
#+BEGIN_SRC emacs-lisp
;;Enables copy/paste from the system clipboard.
(setq select-enable-primary t)
(setq select-enable-clipboard t)
(setq save-interprogram-paste-before-kill t)
(setq kill-do-not-save-duplicates t)
#+END_SRC
** Auto saves
Move the auto-save and backup files into the temp file directory so that emacs doesn't flood the working folders with junk.
#+BEGIN_SRC emacs-lisp
(setq backup-directory-alist
      `((".*" . ,temporary-file-directory)))

(setq auto-save-file-name-transforms
      `((".*" , temporary-file-directory t)))
#+END_SRC
** Startup Message and Screen
#+BEGIN_SRC emacs-lisp
;;Disable splash screen
(setq inhibit-splash-screen t
      inhibit-startup-echo-area-message t
      inhibit-startup-message t)

(setq initial-scratch-message nil)

(defun display-startup-echo-area-message()
  (message (emacs-init-time)))
#+END_SRC
** Dired quick copy/paste
When dired-dwim-target is enabled, dired tries to guess a default target directory. So if there are multiple dired panes open it will use that as the default.
#+BEGIN_SRC emacs-lisp
(setq dired-dwim-target t)
#+END_SRC
** Simple git push
#+BEGIN_SRC emacs-lisp
(defun git-push-all (commit-message)
      (shell-command "git add -A")
      (shell-command (concatenate
                      'string "git commit -m \"" commit-message "\""))
      (shell-command "git push origin master"))
#+END_SRC
* Major Custom Packages
** Ivy
#+BEGIN_SRC emacs-lisp
(use-package ivy
  :diminish ivy-mode
  :ensure counsel
  :ensure swiper
  :bind (("M-x" . counsel-M-x)
         ("C-x C-f" . counsel-find-file)
         ("\C-s" . swiper))
  :config
  (progn
    (ivy-mode 1)))
#+END_SRC
** Evil
#+BEGIN_SRC emacs-lisp
(use-package evil
  :diminish undo-tree-mode
  :diminish evil-goggles-mode
  :ensure evil-matchit
  :ensure evil-surround
  :config
  (progn
    (setq evil-mode-line-format '(before . mode-line-front-space))
    (evil-mode 1)
    ;;Disable evil in these modes
    (evil-set-initial-state 'dired-mode 'emacs)
    (evil-set-initial-state 'erc-mode 'emacs)
    (evil-set-initial-state 'term-mode 'emacs)
    (evil-set-initial-state 'eshell-mode 'emacs)
    (evil-set-initial-state 'message-mode 'emacs)
    (evil-set-initial-state 'compilation-mode 'emacs)
    (global-evil-surround-mode 1)
    (global-evil-matchit-mode 1)
    ))
#+END_SRC

*** Evil-Lispy
#+BEGIN_SRC emacs-lisp
(use-package lispy
  :commands lispy-mode
  :diminish lispy-mode
  :diminish lispyville-mode
  :ensure lispyville
  :config
  (progn
    (add-hook 'lispy-mode-hook #'lispyville-mode)
    (add-hook 'emacs-lisp-mode-hook #'lispy-mode)
    (add-hook 'clojure-mode-hook #'lispy-mode)
    ))
#+END_SRC
** Company
#+BEGIN_SRC emacs-lisp
(use-package company
  :diminish company-mode
  ;;Complete on tab
  :bind (("TAB" . company-indent-or-complete-common))
  :init
  ;; Launch auto-complete with default settings
  (progn
    (add-hook 'after-init-hook 'global-company-mode)))
#+END_SRC
** Flycheck
#+BEGIN_SRC emacs-lisp
(use-package flycheck
  :commands global-flycheck-mode
  :init
  (progn
    (add-hook 'after-init-hook 'global-flycheck-mode)))
#+END_SRC
** Pdf-tools
#+BEGIN_SRC emacs-lisp
(use-package pdf-tools
  :mode ("\\.pdf$" . pdf-view-mode)
  :config
  (add-hook 'pdf-tools-enabled-hook 'pdf-view-midnight-minor-mode)
  (unless (eq system-type 'windows-nt)
    ;; Only install pdf tools on unix
    (pdf-tools-install)
    (define-key pdf-view-mode-map (kbd "j") 'pdf-view-next-line-or-next-page)
    (define-key pdf-view-mode-map (kbd "k") 'pdf-view-previous-line-or-previous-page)))
#+END_SRC
** mtg-deck-mode
#+BEGIN_SRC emacs-lisp
(use-package mtg-deck-mode
  :defer t)
#+END_SRC
** E-reader
#+BEGIN_SRC emacs-lisp
(use-package ereader
  :mode (("\\.epub" . ereader-mode))
  :config
  (progn
    (add-to-list 'evil-emacs-state-modes 'ereader-mode)
    (visual-line-mode 1)))
#+END_SRC
** Mingus
#+BEGIN_SRC emacs-lisp
(use-package mingus
  :commands mingus-browse
  :commands mingus-add-podcast-and-play
  :init
  (progn
    (global-set-key (kbd "C-c m") 'mingus-browse)
    ;;Disable evil in mingus
    (add-hook 'mingus-browse-hook 'evil-emacs-state)
    (add-hook 'mingus-playlist-hooks 'evil-emacs-state)
    ))
#+END_SRC
** Magit
#+BEGIN_SRC emacs-lisp
(use-package magit
  :defer t)
#+END_SRC
** Elfeed
#+BEGIN_SRC emacs-lisp
(use-package elfeed
  :commands elfeed
  :bind (("C-c e" . elfeed))
  :config
  (progn
    ;; Disable evil in all the elfeed panes
    (add-to-list 'evil-emacs-state-modes 'elfeed-show-mode)
    (add-to-list 'evil-emacs-state-modes 'elfeed-search-mode)
    (setq elfeed-feeds
          '(
            ("https://www.xkcd.com/rss.xml" webcomic)
            ("http://www.smbc-comics.com/rss.php" webcomic)
            ("http://nedroid.com/feed/" webcomic)
            ("http://www.awkwardzombie.com/awkward.php" webcomic)
            ("http://existentialcomics.com/rss.xml" webcomic)
            ("http://mega64.com/category/podcast/feed/" podcast)
            ("http://colorcommontary.com/feed/podcast" podcast)
            ("http://www.giantbomb.com/podcast-xml/beastcast" podcast)
            ("http://billburr.libsyn.com/rss" podcast)
            ("http://planet.emacsen.org/atom.xml" blog emacs)
            ("https://www.idlethumbs.net/feeds/idle-thumbs" podcast idlethumbs)
            ("https://www.idlethumbs.net/feeds/twinpeaks" podcast idlethumbs)
            ("https://www.idlethumbs.net/importantiftrue" podcast idlethumbs)
            ;; Imported from OPML
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCq6aw03lNILzV96UvEAASfQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCTWIIYshV8ARj3ZEfuKZTcg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCWcWOXdf-CG6K1gTFgjNNxA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UClN6fvnB1WBaFA83C1Y_EwQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCa96SWr_naf4N4mseKZPbqQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCJHA_jMfCvEnv-3kRjTCQXw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCe1HeEEIHtXIqkGn0Bu0wRg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCiwFcYaaqDSkzaA0CipV2BA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCPD_bxCRGpmmeQcbe2kpPaA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCxsQFG_8Dbt1sZhLReL2mUw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCD_D_S92dKuhwJJcn9lVhtQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCGVm3ydSnNcojI4iMfUjxTg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCxUR9wLuzgsvA6mpgKtiqGw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCyKs7Ta4nQpeoUaP1pl-5PA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCFSXUpyZ_c23gnQguGjtPBQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCMB4u6nVluU9MkMTPUN3mRw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCs_6gVNVQOgq6MGDdt3h8HQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCM0V8r4kuIWIl6Sy-NHj2lg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCG0ndyYFIg5WXPMEMT1nk-Q" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCR1D15p_vdP3HkrH8wgjQRw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UC8e0Sg8TmRRFJytjEGhmVTg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCLmzk98n_v2doN2Y20S-Zog" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCqJ-Xo29CKyLTjn6z2XwYAw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCT3dQ11QZIymHGK-HW--4AQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCo41YdkXVTp4dTXvhduaeYw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCWXPQ_saUN0Hl7bXSo_Tm8A" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UClOGLGPOqlAiLmOvXW5lKbw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCL7DDQWP6x7wy0O6L5ZIgxg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCFg9-S0cfu3UvBYuSNFT9hQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCkpl-VMsq1m9AcWb2QMFHww" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCvG-4K2A6l8yxagVf1I3GpQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCyhnYIvIKK_--PiJXCMKxQQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCrH0zjmdaWXgzUagp_1epMg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCZAZTSd0xnor7hJFmINIBIw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCUR1pFG_3XoZn3JNKjulqZg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCqJ0E420KX9_3lFNJjDoKDA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UC6n8TAE1A04DewMb-k50MCg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCsLlC2-ykzMCmSxlAsIRfZw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCuPgdqQKpq4T4zeqmTelnFg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCEOXxzW2vU0P-0THehuIIeg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCYZtp0YIxYOipX15v_h_jnA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCQD3awTLw9i8Xzh85FKsuJA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCP7QY6L5pvmm0-stL-pNFrw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCRbOPaGDB_xOQkVM8Rnn62Q" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCK3kaNXbB57CLcyhtccV_yw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCr3cBLTYmIK9kY0F_OdFWFQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UC-tsNNJ3yIW98MtPH6PWFAQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCKlUrYO3i9MDlL45Ia6j5EA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCekQr9znsk2vWxBo3YiLq2w" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCT31um1Ic8KweVWEMBC1K7A" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCBa659QWEk1AI4Tg--mrJ2A" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UC9cLJOlWOCE9YmZlLF_OkRA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCRmw2Pw9hrkZbY1TVAwq-_A" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCEKJKJ3FO-9SFv5x5BzyxhQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UC2cWolcQJwlnv-uNSVAMRAA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UC4USoIAL9qcsx5nCZV_QRnA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCE1jXbVAGJQEORz9nZqb5bQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCKhZplFZ1QaLqA_fCTVlU_g" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UC7pp40MU_6rLK5pvJYG3d0Q" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCJkMlOu7faDgqh4PfzbpLdg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCDWIvJwLJsE4LG1Atne2blQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCjdQaSJCYS4o2eG93MvIwqg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCjFqcJQXGZ6T6sxyFB-5i6A" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCe3OX7viy81tqeGGKA2OsEw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCGaPZ6gP6VpDQQHuPyalnkw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCJ6KZTTnkE-s2XFJJmoTAkw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UC7HyRf8pnUeT7bFeAPsA8HQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCmeds0MLhjfkjD_5acPnFlQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UC2e0bNZ6CzT-Xvr070VaGsw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCBOq4k-HFVzV70_nIj3GBAQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCYo4DGKIw8UmIQXbTuP3JsQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCLzE7jLdn7dqxK-0OdXeuaw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCtKcVd4QbAJRFq-PIf22u7g" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCYbVCvFifp-JY6LTRa8663g" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCq6VFHwMzcMXbuKyG7SQYIg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCT22Ehr7vuRpIAaJ7dEkApg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCkitABalXafr-NqceQdDXtg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCF7hRXT2fWVdJxECenBQDXA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCHL9bfHTxCMi-7vfxQ-AYtg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCb_sF2m3-2azOqeNEdMwQPw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCSc16oMxxlcJSb9SXkjwMjA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCWqr2tH3dPshNhPjV5h1xRw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCI3GAJaOTL1BoipG41OmfyA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCsvn_Po0SmunchJYOWpOxMg" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCPswLO6Jrrmg8hXY03eXHAw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCLx053rWZxCiYWsBETgdKrQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCjzWSePFAGMM8jGfXDOV5Tw" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCrTNhL_yO3tPTdQ5XgmmWjA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UC18ju52OET36bdewLRHzPdQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCxt9Pvye-9x_AIcb1UtmF1Q" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCkop4F44-FV6N92-PNAYzxA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCIqOntfIErRuC1u6UyFfy8g" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCy1Ms_5qBTawC-k7PVjHXKQ" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UC84X0epDRFdTrybxEX8ZWkA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UC_B2NiaRkm0RKvlG6_LzNuA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCRhIOngepmb7ukktvGP5u0A" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCgc4xqIMDoiP4KOTFS21TJA" youtube)
            ("https://www.youtube.com/feeds/videos.xml?channel_id=UCGFhIp3VXy90--3PfAqtSaA" youtube)
            ))

    (defun elfeed-mark-all-as-read ()
      (interactive)
      (mark-whole-buffer)
      (elfeed-search-untag-all-unread))
    (define-key elfeed-search-mode-map (kbd "c") 'elfeed-mark-all-as-read)))
#+END_SRC
** Auctex
#+BEGIN_SRC emacs-lisp
(use-package auctex
  :ensure company-auctex
  :mode (("\\.tex$" . latex-mode)
         ("\\.latex$" . latex-mode))
  :config
  (progn
    (add-hook 'latex-mode-hook 'turn-on-auto-fill)
    (add-hook 'latex-mode-hook 'visual-line-mode)
    (company-auctex-init)))
#+END_SRC
** Pass
#+BEGIN_SRC emacs-lisp
(use-package password-store
  :commands (password-store-copy))
#+END_SRC
** BBDB
#+BEGIN_SRC emacs-lisp
(use-package bbdb
  :commands (bbdb-insinuate-gnus)
  :config
  (progn
    (setq bbdb-check-postcode nil)
    (add-hook 'gnus-startup-hook 'bbdb-insinuate-gnus)
    (setq bbdb-file "~/Sync/Essential/bbdb")
    (bbdb-initialize 'message 'gnus)
    ;;Automatically create bbdb entries
    (bbdb-mua-auto-update-init 'gnus 'message)
    (setq bbdb-update-records-p 'create)
    (setq bbdb-ignore-message-alist '(
                                      ("From" . "mailer-daemon\\|no-reply")
                                      ("From" . "craigslist")
                                      (("To" "CC") . "mailing-list-1\\|mailing-list-2")
                                      (("To" "CC") . "superstepag@gmail.com")
                                      ))))
#+END_SRC
** Projectile
#+BEGIN_SRC emacs-lisp
(use-package projectile
  :commands projectile-mode
  :ensure counsel-projectile
  :config
  (progn
    (add-hook 'prog-mode-hook 'projectile-mode)
    (add-hook 'projectile-mode-hook 'counsel-projectile-on)))
#+END_SRC
** Currently disabled
*** Relative Line Numbers
Relative line numbers. Currently disabled, because having them seems a bit redundant with vim easymotions.
#+BEGIN_SRC emacs-lisp
;; Relative line package
(use-package nlinum-relative
  :commands nlinum-relative-mode
  :disabled t
  :init
  (progn
    (setq nlinum-relative-redisplay-delay 0)
    (setq nlinum-relative-current-symbol "")
    (setq nlinum-relative-offset 0)
    (add-hook 'prog-mode-hook 'nlinum-relative-mode))
  :config
  (progn
    (nlinum-relative-setup-evil)
    ))
#+END_SRC
Not using projectile right now.
*** notmuch
Currently using gnus for my email.
#+BEGIN_SRC emacs-lisp
(unless t
  (autoload 'notmuch "notmuch" "notmuch mail" t)
  (add-hook 'notmuch-hello-mode 'evil-emacs-state)
  (add-hook 'notmuch-message-mode 'evil-emacs-state)
  (add-hook 'notmuch-search-mode 'evil-emacs-state))
#+END_SRC
* Programming Modes
** Language Independent Settings
*** Indentation
**** Whitespace mode
Always enable whitespace mode
#+BEGIN_SRC emacs-lisp
(use-package whitespace
  :commands whitespace-mode
  :diminish whitespace-mode
  :config
  (add-hook 'prog-mode-hook 'whitespace-mode))
#+END_SRC

**** Aggressive indent
Automatic indentation.
#+BEGIN_SRC emacs-lisp
(use-package aggressive-indent
  :diminish aggressive-indent-mode
  :config
  (progn
    (global-aggressive-indent-mode)
    (add-to-list 'aggressive-indent-excluded-modes 'python-mode)))
#+END_SRC
**** Disabled
***** Indent Guides
Better indent guides. Currently disabled because they cause insane hangs in python mode.
#+BEGIN_SRC emacs-lisp
(use-package highlight-indent-guides
  :disabled t
  :commands highlight-indent-guides-mode
  :diminish highlight-indent-guides-mode
  :config
  (progn
    (setq highlight-indent-guides-method 'character)
    (add-hook 'prog-mode-hook 'highlight-indent-guides-mode)))
#+END_SRC
*** Misc
#+BEGIN_SRC emacs-lisp
(add-hook 'prog-mode-hook 'electric-pair-mode)

(use-package rainbow-delimiters
  :commands rainbow-delimiters-mode
  :init
  (add-hook 'prog-mode-hook 'rainbow-delimiters-mode))

#+END_SRC
**** Disabled
***** yasnippet
Not using yasnippet right now but it could become useful in the future.
#+BEGIN_SRC emacs-lisp
(use-package yasnippet
  :disabled t
  :ensure nil
  :commands yas-minor-mode
  :diminish yas-minor-mode
  :init
  (progn
    (add-hook 'prog-mode-hook 'yas-minor-mode)))
#+END_SRC
** C-Mode
#+BEGIN_SRC emacs-lisp
;;Indent c++ code with 4 spaces
(defun indent-c-mode-hook ()
  (setq c-basic-offset 4
        c-indent-level 4
        c-default-style "linux"))
(add-hook 'c-mode-common-hook 'indent-c-mode-hook)
#+END_SRC
** Python
*** Company-Jedi
#+BEGIN_SRC emacs-lisp
(use-package company-jedi
  :mode (("\\.py$" . python-mode))
  :config
  (progn
    (add-hook 'python-mode-hook
              (lambda ()
                (set (make-local-variable 'company-backends) '(company-tern))))
))
#+END_SRC
*** Disabled
**** Autopep8
Using flycheck instead
#+BEGIN_SRC emacs-lisp
(use-package py-autopep8
  :disabled t
  :commands py-autopep8-enable-on-save
  :mode (("\\.py$" . python-mode))
  :init
  (progn
    (add-hook 'python-mode-hook 'py-autopep8-enable-on-save))
  )
#+END_SRC
** Javascript
#+BEGIN_SRC emacs-lisp
(use-package js2-mode
  :ensure nil
  :ensure company-tern
  :mode (("\\.js$" . js2-mode))
  :config
  (progn
    (defun my-js-hook ()
      (add-to-list 'company-backends 'company-tern))
    (add-hook 'js2-mode-hook 'my-js-hook)))
#+END_SRC
** Web/HTML
#+BEGIN_SRC emacs-lisp
(use-package web-mode
  :mode (("\\.html$" . web-mode))
  :ensure company-web
  :config
  (progn
    (defun my-web-mode-hook ()
      "Hooks for Web mode."
      (setq web-mode-markup-indent-offset 2)

      (set (make-local-variable 'company-backends)
           '(company-web-html company-files))

      (whitespace-turn-off))
    (add-hook 'web-mode-hook  'my-web-mode-hook)))

(use-package skewer-mode
  :defer t
  :config
  (progn
    (add-hook 'css-mode-hook 'skewer-css-mode)
    (add-hook 'html-mode-hook 'skewer-html-mode)
    (add-to-list 'evil-emacs-state-modes 'skewer-repl-mode)
    ))

(use-package emmet-mode
  :commands emmet-mode
  :config
  (progn
    (setq emmet-move-cursor-between-quotes t)
    (add-hook 'web-mode-hook 'emmet-mode)
    (add-hook 'html-mode-hook 'emmet-mode)))
#+END_SRC
** Markdown
#+BEGIN_SRC emacs-lisp
(use-package markdown-mode
  :commands (markdown-mode gfm-mode)
  :mode (("README\\.md\\'" . gfm-mode)
         ("\\.md\\'" . markdown-mode)
         ("\\.markdown\\'" . markdown-mode))
  :config
  (progn
    (setq markdown-command "multimarkdown")
    (add-hook 'markdown-mode-hook 'visual-line-mode)))
#+END_SRC
** Shell
#+BEGIN_SRC emacs-lisp
(use-package company-shell
  :mode (("\\.sh$" . shell-script-mode))
  :config
  (progn
    (add-hook 'shell-script-mode-hook
              (lambda ()
                (set (make-local-variable 'company-backends) '(company-shell))))
    )
  )
#+END_SRC
** Lua
#+BEGIN_SRC emacs-lisp
(use-package lua-mode
  :mode (("\\.lua" . lua-mode)))
#+END_SRC
*** Company-lua
#+BEGIN_SRC emacs-lisp
(use-package company-lua
  :mode (("\\.lua" . lua-mode))
  :config
  (progn
    (add-hook 'lua-mode-hook (lambda()
                               (setq-local company-backends '(company-lua))))))
#+END_SRC
*** Flycheck-lua
#+BEGIN_SRC emacs-lisp
(use-package flymake-lua
  :mode (("\\.lua" . lua-mode)))
#+END_SRC
*** Love
#+BEGIN_SRC emacs-lisp
(use-package love-minor-mode
  :commands (love-minor-mode)
  :config
  (progn
    (add-hook 'love-minor-mode-hook
              (lambda()
                (set (make-local-variable 'compile-command)
                     (concat "love " default-directory))))))
#+END_SRC
** Scheme
#+BEGIN_SRC emacs-lisp
(use-package geiser
  :config
  (progn
    (setq geiser-active-implementations '(chicken))))
#+END_SRC
** Currently disabled
*** Slime
Not using slime right now
#+BEGIN_SRC emacs-lisp
(use-package slime
  :disabled t
  :ensure nil
  :commands slime)
#+END_SRC
*** Rust
 https://christian.kellner.me/2017/05/31/language-server-protocol-lsp-rust-and-emacs/
#+BEGIN_SRC emacs-lisp
(use-package cargo
  :commands cargo-minor-mode
  :disabled t
  :ensure nil
  :init
  (progn
    (add-hook 'rust-mode-hook 'cargo-minor-mode)))
(use-package rust-mode
  :mode (("\\.rs$" . rust-mode))
  :disabled t
  :ensure nil)

(use-package racer
  :commands racer-mode
  :disabled t
  :ensure nil
  :init
  (progn
    (setq racer-rust-src-path (file-truename "/usr/src/rust/src"))
    (add-hook 'rust-mode-hook #'racer-mode)
    (add-hook 'racer-mode-hook #'eldoc-mode)))


(use-package flycheck-rust
  :commands flycheck-rust-setup
  :disabled t
  :ensure nil
  :init
  (progn
    (add-hook 'flycheck-mode-hook #'flycheck-rust-setup)))
#+END_SRC
*** Clojure
#+BEGIN_SRC emacs-lisp
(use-package cider
  :commands (cider-jack-in)
  :disabled t
  :init
  (progn
    (add-to-list 'evil-emacs-state-modes 'cider-repl-mode)))
#+END_SRC
* Org Mode
#+BEGIN_SRC emacs-lisp
(use-package org
  :defer t
  :diminish (org-indent-mode visual-line-mode flyspell-mode evil-org-mode)
  :ensure org-bullets
  :ensure htmlize
  :config
  (progn
    (setq org-src-preserve-indentation nil
          org-edit-src-content-indentation 0
          org-src-fontify-natively t
          org-src-tab-acts-natively t
          org-confirm-babel-evaluate nil
          org-return-follows-link t
          org-startup-with-inline-images t
          ;; Automatically preview latex fragments, and store the image files in the temp directory
          org-startup-with-latex-preview t
          org-latex-preview-ltxpng-directory (expand-file-name
                                              (concat temporary-file-directory "ltxpng/"))
          ;; org-latex-create-formula-image-program 'imagemagick
          org-list-allow-alphabetical t

          org-notes-location "~/Sync/Notes/"
          org-todo-location (expand-file-name
                             (concat org-notes-location "agenda.org"))
          org-default-notes-file org-todo-location

          org-agenda-files (list org-todo-location)
          )

    ;; org-src config
    (setq
     org-edit-src-content-indentation 0
     org-src-fontify-natively t
     org-src-tab-acts-natively t
     org-src-window-setup 'current-window)

    ;; Make windmove work in org-mode:
    (add-hook 'org-shiftup-final-hook 'windmove-up)
    (add-hook 'org-shiftleft-final-hook 'windmove-left)
    (add-hook 'org-shiftdown-final-hook 'windmove-down)
    (add-hook 'org-shiftright-final-hook 'windmove-right)

    (setq org-capture-templates
          '(("t" "Todo" entry (file+headline org-todo-location "Tasks")
             "* TODO %?\n  %i\n  %a")
            ("c" "Clipboard" entry (file+headline org-todo-location "Links")
             "* %?\n %x")))

    ;; Org-publish config
    (setq org-html-validation-link nil)
    (setq org-publish-project-alist
          '(("org-blog"
             ;;The directory containing our blog posts
             :base-directory "~/Sync/Notes/blog"
             ;; The directory where the final result will be copied to
             :publishing-directory "~/Sync/Notes/publish"
             :publishing-function org-html-publish-to-html
             ;; Generate a list of all posts
             :auto-sitemap t
             :sitemap-filename "index.org"
             :sitemap-title "Neosloth's Blog"
             :sitemap-file-entry-format "\"%t\" by %a on %d."
             :sitemap-date-format "%B %dth, %Y"
             :sitemap-sort-files t
             :auto-preamble t
             :html-head "<link rel=\"stylesheet\"
                       href=\"./css/style.css\" type=\"text/css\"/>"
             )
            ("org-static"
             :base-directory "~/Sync/Notes/blog"
             :base-extension "css\\|js\\|png\\|jpg\\|gif\\|pdf\\|mp3\\|ogg\\|swf\\|ico"
             :publishing-directory "~/Sync/Notes/publish"
             :recursive t
             :publishing-function org-publish-attachment)
            ("org" :components ("org-blog" "org-static"))))


    (add-hook 'org-mode-hook 'flyspell-mode)
    (add-hook 'org-mode-hook 'org-toggle-pretty-entities)
    (add-hook 'org-mode-hook 'org-bullets-mode)
    (add-hook 'evil-org-mode-hook (lambda ()
                                    (evil-org-set-key-theme)))
    (add-hook 'org-mode-hook 'org-indent-mode)
    (add-hook 'org-mode-hook 'visual-line-mode)
    )
  (require 'org-bullets)
  (require 'htmlize)
  (require 'ox-md)

  (org-babel-do-load-languages
   'org-babel-load-languages
   '((python . t)
     (java . t)
     (C . t)
     (gnuplot . t)
     (sh . t)
     (calc . t)
     (scheme . t)
     (js . t)
     ))

  (defun publish-and-push (&optional blog msg)
    "Publish a blog named BLOG and push a new git commit with MSG."
    (interactive)
    (or blog (setq blog "blog"))
    (or name (setq name (format-time-string "%FT%T%z")))
    (org-publish blog)
    (let ((default-directory (plist-get
                              (cdr (car org-publish-project-alist))
                              :publishing-directory)))
      (git-push-all msg))))
#+END_SRC

* Gnus
#+BEGIN_SRC emacs-lisp
(use-package gnus
  :commands gnus
  :ensure org-mime
  :config

  ;; @see http://www.emacswiki.org/emacs/GnusGmail#toc1
  (setq gnus-select-method '(nntp "news.gmane.org")) ;; if you read news groups

  (defun my-gnus-group-list-subscribed-groups ()
    "List all subscribed groups with or without un-read messages"
    (interactive)
    (gnus-group-list-all-groups 5))

  (add-hook 'gnus-group-mode-hook
            ;; list all the subscribed groups even they contain zero un-read messages
            (lambda () (local-set-key "o" 'my-gnus-group-list-subscribed-groups )))

  ;; ask encryption password once
  (setq epa-file-cache-passphrase-for-symmetric-encryption t)

  (setq gnus-thread-sort-functions
        '(gnus-thread-sort-by-most-recent-date
          (not gnus-thread-sort-by-number)))
  (setq gnus-thread-hide-subtree t)
  (setq user-mail-address "superstepag@gmail.com"
        user-full-name "Stefan Kuznetsov")

  (setq nnmail-expiry-target "nnimap+gmail:[Gmail]/Trash")
  (setq nnmail-expiry-wait 'immediate)
  (setq gnus-select-method
        '(nnimap "main"
                 (nnimap-address "imap.gmail.com")
                 (nnimap-server-port "imaps")
                 (nnimap-stream ssl)))

  (setq gnus-secondary-select-methods
        '((nnimap "official"
                  (nnimap-address "imap.gmail.com")
                  (nnimap-server-port "imaps")
                  (nnimap-stream ssl)
                  )
          (nnimap "hotmail"
                  (nnimap-address "outlook.office365.com")
                  (nnimap-server-port 993)
                  )
          ))

  (setq gnus-posting-styles
        '(((header "to" "superstepag@gmail.com")
           (address "superstepag@gmail.com"))
          ((header "to" "stepan.s.kuznetsov@gmail.com")
           (address "stepan.s.kuznetsov@gmail.com"))
          ((header "cc" "superstepag@gmail.com")
           (address "superstepag@gmail.com"))
          ((header "cc" "stepan.s.kuznetsov@gmail.com")
           (address "stepan.s.kuznetsov@gmail.com"))))

  ;;send mail config
  (setq message-send-mail-function 'smtpmail-send-it
        smtpmail-smtp-server "smtp.gmail.com"
        smtpmail-smtp-service 587
        gnus-ignored-newsgroups "^to\\.\\|^[0-9. ]+\\( \\|$\\)\\|^[\"]\"[#'()]")

  (defun my-message-mode-setup ()
    "Turn on auto fill when composing emails."
    (flyspell-mode t)
    (setq fill-column 72)
    (turn-on-auto-fill))

  (add-hook 'message-mode-hook 'my-message-mode-setup)

  (require 'org-mime)
  (setq org-mime-library 'mml)

  (defun exit-gnus-on-exit ()
    (if (and (fboundp 'gnus-group-exit)
             (gnus-alive-p))
        (with-current-buffer (get-buffer "*Group*")
          (let (gnus-interactive-exit)
            (gnus-group-exit)))))

  (add-hook 'kill-emacs-hook 'exit-gnus-on-exit))
#+END_SRC
* ERC
#+BEGIN_SRC emacs-lisp
(use-package erc
  :disabled t
  :commands irc-connect
  :ensure erc-hl-nicks
  :init
  (progn
    (setq erc-prompt-for-password nil)
    ;; Switch current buffer whenever you are mentioned
    (setq erc-auto-query 'buffer)
    (setq erc-nick "neosloth")
    (setq erc-kill-buffer-on-part t)
    (setq erc-autojoin-channels-alist
          '((".*freenode.net" "#emacs")
            (".*undernet.org" "#bookz")
            (".*abjects.net" "#mg-chat" "#moviegods")
            ))
    (defun irc-connect ()
      "Connect to IRC interactively."
      (interactive)
      (setq servers '(
                      ("Freenode" . "irc.freenode.net")
                      ("Undernet" . "ix1.undernet.org")
                      ("Abjects" . "irc.abjects.net")
                      ))
      (dolist (server servers)
        (when (y-or-n-p (car server))
          (erc :server (cdr server) :port 6667)))))

  :config
  (progn
    (add-hook 'window-configuration-change-hook
              '(lambda()
                 (setq erc-fill-column (- (window-width) 2))))
    (erc-hl-nicks-mode 1)
    (toggle-truncate-lines)
    (erc-spelling-mode 1)
    (erc-notifications-mode 1)
    (erc-scrolltobottom-enable)))
#+END_SRC
* IRC
#+BEGIN_SRC emacs-lisp
(use-package rcirc
  :commands irc
  :config
  (progn
    (if (file-exists-p "~/.emacs.d/secrets.el.gpg")
        (load-library "~/.emacs.d/secrets.el.gpg"))
    (add-hook 'rcirc-mode-hook (lambda ()
                                 (flyspell-mode 1)))
    (setq rcirc-default-nick "neosloth")
    (setq rcirc-server-alist
          '(("irc.freenode.net" :channels ("#emacs"))))))
#+END_SRC

* Theme
#+BEGIN_SRC emacs-lisp
(use-package zerodark-theme
  :config
  (load-theme 'zerodark t)
  (custom-set-faces
   ;; Brighter rainbow delimiters
   '(rainbow-delimiters-depth-1-face ((t (:foreground "dark orange"))))
   '(rainbow-delimiters-depth-2-face ((t (:foreground "deep pink"))))
   '(rainbow-delimiters-depth-3-face ((t (:foreground "chartreuse"))))
   '(rainbow-delimiters-depth-4-face ((t (:foreground "deep sky blue"))))
   '(rainbow-delimiters-depth-5-face ((t (:foreground "yellow"))))
   '(rainbow-delimiters-depth-6-face ((t (:foreground "orchid"))))
   '(rainbow-delimiters-depth-7-face ((t (:foreground "spring green"))))
   '(rainbow-delimiters-depth-8-face ((t (:foreground "sienna1"))))))
#+END_SRC
